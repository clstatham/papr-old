import "oscs.papr"
import "envs.papr"

graph main {
    |
        #fm_amt(0:1) = 1.0
        #fm_mul(0.25:8.0) = 1.0
        #decay0(0.1:2.0) = 1.0
        #decay1(0.1:2.0) = 1.0
    | -> |@dac0|
    ~ {
        let [#pitch0 #vel0] = #notein();
        let #denv0 = #denv(#vel0 #decay0);
        let #denv1 = #denv(#vel0 #decay1);
        let #freq = #m2f(#pitch0);
        let @s1 = @sineosc_manual(#fm_amt (#fm_mul * #freq) 0.0 0.0);
        let @s0 = @sineosc_manual(#denv0 #freq #denv1 @s1);
        let @res = (@s0 ^ @s1);
        @dac0 = @if((@abs(@res) > 0.5) @s0 @s1);
    }
}
