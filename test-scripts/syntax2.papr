graph sineosc_manual {
    |amp freq fm_amt fm| -> |out|
    ~ {
        let TAU = (3.14159265 * 2);
        let s = sin((((t * TAU) * freq) + ((fm * TAU) * fm_amt)));
        out = (s * amp);
    }
}

graph main {
    |
        #fm_amt(0:1) = 1.0
        #fm_mul(0.25:8.0) = 1.0
    | -> |@dac0|
    ~ {
        let [#pitch0 #vel0] = #notein();
        let #freq = #m2f(#pitch0);
        let @fm = @sineosc_manual(#fm_amt (#fm_mul * #freq) 0.0 0.0);
        @dac0 = @sineosc_manual(#vel0 #freq 1.0 @fm);
    }
}
