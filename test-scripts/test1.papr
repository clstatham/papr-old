import "oscs.papr"
import "envs.papr"

graph Main {
    || -> |@dac0|
    ~ {
        let #fm_amt = #Slider<0 1 1.0>();
        let #fm_mul = #Slider<0.25 8 1.0>();
        let #decay0 = #Slider<0.1 2.0 1.0>();
        let #decay1 = #Slider<0.1 2.0 1.0>();

        let [#pitch0 #vel0] = #NoteIn();
        let #denv0 = #Denv(#vel0 #decay0);
        let #denv1 = #Denv(#vel0 #decay1);
        let #freq = #M2F(#pitch0);
        let @s1 = @SineFm(#fm_amt (#fm_mul * #freq) 0.0 0.0);
        let @s0 = @SineFm(#denv0 #freq #denv1 @s1);
        let @res = (@s0 ^ @s1);
        @dac0 = (@res * @s0);
    }
}
