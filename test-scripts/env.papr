graph denv {
    @in {}
    @out {}
    #in { #gate = 0 #decay = 0 }
    #out { #out }
    ~ {
        create re: redge;
        re.#trigger <- #gate;

        create t_trig: var;
        t_trig.#set <- re.#out;
        t_trig.#input <- #t;

        let #dif <- (#t - t_trig.#out);
        
        create mx: max;
        mx.#a <- (#decay - #dif);
        mx.#b <- #0.0;
        #out <- (#gate * mx.#out);
    }
}

graph main {
    @in {}
    @out { @dac0 }
    #in { #decay(0.1 : 2.0) = 1.0 }
    #out {}
    ~ {
        create ni: notein;
        create s: sineosc;
        create s_m2f: m2f;

        s_m2f.#m <- ni.#note0;
        s.#freq <- s_m2f.#f;

        create env: denv;
        env.#decay <- #decay;
        env.#gate <- ni.#vel0;
        s.#amp <- env.#out;

        @dac0 <- s.@out;
    }
}